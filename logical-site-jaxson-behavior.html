<!-- 
Logical Site Jaxson Behavior
	Description: Hanles AJAX Requests
	Created by: Kevin Ashcraft
	Created on: 2015-12-22
	Last Modified: 2016-04-20
	Repo: https://github.com/LogicDudes/logical-site-behaviors
-->
<script>
Polymer.LogicalSiteJaxsonBehavior = {

	jaxson: function(request, body, that) {

		var body = body || {};

		if(request != 'multi') {
			body.request = request;
			body = [body];
		}

		var that = that || this;

		var jaxson = document.createElement('iron-request');
		jaxson.completes.then(function(r){
			var responses = r.response;

			var response = responses.shift();
			this.set('Site.Token', response.SiteToken);

			for(var i in responses) {
				var response = responses[i];
				
				if(response.toast) {
					var duration = response.toastDuration || 2000;
					var undo = false;
					if(response.undoUrl) {
						duration = response.toastDuration || 9000;
						this.undoParams = response.undoParams;
						this.undoUrl = response.undoUrl;
						this.that = this;
						undo = true;
					}
					this.Toast(response.toast, duration, undo);
				}
				if(that && typeof that._jaxson == 'function') {
					that._jaxson(response);
				} else {
					console.log("response", response);
					console.log("body", body);
					console.log("that", that);
				}
			}

		}.bind(this));
		jaxson.send({
			method: 'POST',
			body: body,
			handleAs: 'json',
			url: '/Jaxson/',
			headers: { 'Content-Type': 'application/json', 'Site-Token': this.Site.Token },
		});
	},
};
</script>